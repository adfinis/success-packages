<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Vault usage</title>
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="stylesheet" href="./dist/reset.css" />
    <link rel="stylesheet" href="./dist/reveal.css" />
    <link rel="stylesheet" href="./dist/theme/night.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/base16/zenburn.css" />

    <link rel="stylesheet" href="./_assets/./assets/reveal-md/css/night.css" />

  </head>
  <body>
    <div class="reveal">
      <div class="slides"><section  data-markdown><script type="text/template">

# Vault usage
</script></section><section  data-markdown><script type="text/template">
A guide on how to use HashiCorp Vault.
</script></section><section  data-markdown><script type="text/template">
## Introduction

- Who am I?
- Who/what is Adfinis?
- Who are you?
</script></section><section  data-markdown><script type="text/template">
## Topics

- Vault
- UI
- CLI
- API
- Vault Agent
- Vault SDK
</script></section><section ><section data-markdown><script type="text/template">
## Vault

A tool to manage *secrets*, typically for *systems*.

> Secrets: Anything sensitive; credentials, API keys, SSL keys, etc.

> Systems: An application like Tomcat, CI, k8s, etc.
</script></section><section data-markdown><script type="text/template">
## Join the experiment!

- [Install Vault](https://developer.hashicorp.com/vault/docs/install).
- [Start Vault](https://developer.hashicorp.com/vault/tutorials/getting-started/getting-started-dev-server).
</script></section><section data-markdown><script type="text/template">
## Quick instruction

```shell
> vault server -dev
> export VAULT_ADDR="http://127.0.0.1:8200"
```
</script></section><section data-markdown><script type="text/template">
## Ways to use Vault

- UI.
- CLI.
- API.

> In the end, it's all API.
</script></section><section data-markdown><script type="text/template">
## What we're doing

For each method (UI, CLI, API) we will:

1. Create a secret.
2. Read the secret.
</script></section></section><section ><section data-markdown><script type="text/template">
## Vault UI 1/4

User friendly, not all features are available.
</script></section><section data-markdown><script type="text/template">
## Vault UI 2/4

![The Vault UI overview](https://raw.githubusercontent.com/adfinis/success-packages/master/assets/images/Vault-overview.png)
</script></section><section data-markdown><script type="text/template">
## Vault UI 3/4

![The Vault UI secrets engine](https://raw.githubusercontent.com/adfinis/success-packages/master/assets/images/Vault-secrets-engine.png)
</script></section><section data-markdown><script type="text/template">
## Vault UI 4/4

![The Vault UI kv secret](https://raw.githubusercontent.com/adfinis/success-packages/master/assets/images/Vault-secret.png)
</script></section></section><section ><section data-markdown><script type="text/template">
## Vault CLI 1/4

Mostly used for administration, experimenting and debugging.
</script></section><section data-markdown><script type="text/template">
## Vault CLI 2/4

```shell
> vault login
Token (will be hidden): 
Success! You are now authenticated. The token information displayed below
is already stored in the token helper. You do NOT need to run "vault login"
again. Future Vault requests will automatically use this token.

Key                  Value
---                  -----
token                hvs.OVWwDAoEvtdYh8Qe0nvFuOPE
token_accessor       76oHT2vMS7CAQYPPxDXYyiUB
token_duration       âˆž
token_renewable      false
token_policies       ["root"]
identity_policies    []
policies             ["root"]
```
</script></section><section data-markdown><script type="text/template">
## Vault CLI 3/4

```shell
> vault kv put -mount=secret my_secret \
  username=myusername \
  password=mypassword
==== Secret Path ====
secret/data/my_secret

======= Metadata =======
Key                Value
---                -----
created_time       2023-12-07T10:06:40.850236Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            1
```
</script></section><section data-markdown><script type="text/template">
## Vault CLI 4/4

```shell
> vault kv get secret/my_secret
====== Data ======
Key         Value
---         -----
password    mypassword
username    myusername
```

- YAML: `vault kv get --field=data --format=yaml secret/my_secret`
</script></section></section><section ><section data-markdown><script type="text/template">
## Vault API 1/4

Well [documented](https://developer.hashicorp.com/vault/api-docs), and feature complete.
</script></section><section data-markdown><script type="text/template">
## Vault API 2/4

```shell
export VAULT_TOKEN="hvs.OVWwDAoEvtdYh8Qe0nvFuOPE"
curl \
    -H "X-Vault-Token: ${VAULT_TOKEN}" \
    -H "Content-Type: application/json" \
    -X POST \
    -d '{"data":{"username":"myusername", "password":"mypassword"}}' \
    http://127.0.0.1:8200/v1/secret/data/my_secret
```
</script></section><section data-markdown><script type="text/template">
## Vault API 3/4

```shell
curl \
    -H "X-Vault-Token: ${VAULT_TOKEN}" \
    -X GET \
    http://127.0.0.1:8200/v1/secret/data/my_secret 
```
</script></section><section data-markdown><script type="text/template">
## Vault API 4/4

```json
{
  "request_id": "4b15ae49-1c45-1052-c106-b7d005dc2858",
  "lease_id": "",
  "renewable": false,
  "lease_duration": 0,
  "data": {
    "data": {
      "password": "mypassword",
      "username": "myusername"
    },
    "metadata": {
      "created_time": "2023-12-07T09:03:27.87442Z",
      "custom_metadata": null,
      "deletion_time": "",
      "destroyed": false,
      "version": 1
    }
  },
  "wrap_info": null,
  "warnings": null,
  "auth": null
}
```
</script></section></section><section  data-markdown><script type="text/template">
## Authentication

1. Login using a method (approle, userpass, etc.)
2. Retrieve a token.
3. Use the token to access Vault.
</script></section><section ><section data-markdown><script type="text/template">
## Vault agent

The agent can be used to:

1. Authenticate to Vault.
2. Store the token.
3. Write secrets to disk.

> Updates to a secret will be automatically written to disk.
</script></section><section data-markdown><script type="text/template">
## Vault agent setup

See [here](https://github.com/adfinis/success-packages/tree/master/assets/vault-agent).
</script></section></section><section ><section data-markdown><script type="text/template">
## Vault SDK

There are [libraries](https://developer.hashicorp.com/vault/api-docs/libraries) for many languages.
</script></section><section data-markdown><script type="text/template">
## Vault SDK - Ansible

```yaml
    - name: Show username
      ansible.builtin.debug:
        msg: "username: {{ lookup('community.hashi_vault.hashi_vault', 'secret=secret/data/my_secret:username') }}"
      environment:
        ANSIBLE_HASHI_VAULT_ADDR: "{{ vault_addr }}"
        ANSIBLE_HASHI_VAULT_TOKEN: "{{ vault_token }}"
```

> See [demo](https://github.com/adfinis/success-packages/tree/master/assets/vault-ansible-sdk)
</script></section></section><section  data-markdown><script type="text/template">
## Questions
</script></section><section  data-markdown><script type="text/template">
## Thanks
</script></section></div>
    </div>

    <script src="./dist/reveal.js"></script>

    <script src="./plugin/markdown/markdown.js"></script>
    <script src="./plugin/highlight/highlight.js"></script>
    <script src="./plugin/zoom/zoom.js"></script>
    <script src="./plugin/notes/notes.js"></script>
    <script src="./plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        slideNumber: true,
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
